<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <meta charset="UTF-8">


    <title>客户关怀列表</title>

    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="This is my page">
    <style type="text/css">
        <!--
        body {
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
        }

        .STYLE1 {
            font-size: 12px
        }

        .STYLE3 {
            font-size: 12px;
            font-weight: bold;
        }

        .STYLE4 {
            color: #03515d;
            font-size: 12px;
        }

        a {
            text-decoration: none;
            color: #033d61;
            font-size: 12px;
        }

        A:hover {
            COLOR: #f60;
            TEXT-DECORATION: underline
        }

        -->
    </style>
    <script type="text/javascript" src="/static/jquery-1.9.1.js"></script>
    <script>
        var highlightcolor = '#c1ebff';
        var clickcolor = '#51b2f6';

        function changeto() {
            source = event.srcElement;
            if (source.tagName == "TR" || source.tagName == "TABLE")
                return;
            while (source.tagName != "TD")
                source = source.parentElement;
            source = source.parentElement;
            cs = source.children;
//alert(cs.length);
            if (cs[1].style.backgroundColor != highlightcolor && source.id != "nc" && cs[1].style.backgroundColor != clickcolor)
                for (i = 0; i < cs.length; i++) {
                    cs[i].style.backgroundColor = highlightcolor;
                }
        }

        function changeback() {
            if (event.fromElement.contains(event.toElement) || source.contains(event.toElement) || source.id == "nc")
                return
            if (event.toElement != source && cs[1].style.backgroundColor != clickcolor)
//source.style.backgroundColor=originalcolor
                for (i = 0; i < cs.length; i++) {
                    cs[i].style.backgroundColor = "";
                }
        }

        function clickto() {
            source = event.srcElement;
            if (source.tagName == "TR" || source.tagName == "TABLE")
                return;
            while (source.tagName != "TD")
                source = source.parentElement;
            source = source.parentElement;
            cs = source.children;
//alert(cs.length);
            if (cs[1].style.backgroundColor != clickcolor && source.id != "nc")
                for (i = 0; i < cs.length; i++) {
                    cs[i].style.backgroundColor = clickcolor;
                }
            else
                for (i = 0; i < cs.length; i++) {
                    cs[i].style.backgroundColor = "";
                }
        }
    </script>
    <script type="text/javascript">
        function add() {
            window.location = "../customer_care_add/";
        }

    </script>
</head>

<body>


<form action="http://localhost:8080/crm/servlet/CustomerCareQueryServlet" method="post">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td height="30" background="/static/tab_05.gif">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="12" height="30"><img src="/static/tab_03.gif" width="12" height="30"/></td>
                        <td>
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td class="STYLE4" align="center">&nbsp;&nbsp;请输入查询内容：<input type="text"
                                                                                                 id="customerInput"
                                                                                                 name="customerInput"
                                                                                                 style="width: 290px"/>
                                    </td>
                                    <td class="STYLE4">&nbsp;&nbsp;请选择查询方式：<select name="queryType" id="queryType"
                                                                                   style="width: 100px">
                                        <option value="1">关怀客户</option>
                                        <option value="2">关怀主题</option>
                                        <option value="3">关怀方式</option>
                                    </select>
                                    </td>
                                    <td class="STYLE4">&nbsp;&nbsp;<input type="button" value="查询" onclick="chick()"
                                                                          style="width:50px"/></td>
                                    <td class="STYLE4">&nbsp;&nbsp;<input type="button" onclick="add()" value="添加"
                                                                          style="width:50px"/></td>
                                </tr>
                            </table>
                        </td>
                        <td width="16"><img src="/static/tab_07.gif" width="16" height="30"/></td>
                    </tr>
                </table>
            </td>
        </tr>


        <tr>
            <td>
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="8" background="/static/tab_12.gif">&nbsp;</td>
                        <td>
                            <table width="100%" border="0" cellpadding="0" cellspacing="1" bgcolor="b5d6e6"
                                   onmouseover="changeto()" onmouseout="changeback()">
                                <thead>
                                <tr>
                                    <th width="2%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">序号</span></div>
                                    </th>
                                    <th width="3%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">客户</span></div>
                                    </th>
                                    <th width="4%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">关怀主题</span></div>
                                    </th>
                                    <th width="4%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">关怀方式</span></div>
                                    </th>

                                    <th width="5%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">关怀时间</span></div>
                                    </th>
                                    <th width="5%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">下次关怀时间</span></div>
                                    </th>

                                    <th width="10%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">备注</span></div>
                                    </th>
                                    <th width="3%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF">
                                        <div align="center"><span class="STYLE1">关怀人</span></div>
                                    </th>

                                    <th width="4%" height="22" background="/static/bg2.gif" bgcolor="#FFFFFF"
                                        class="STYLE1">
                                        <div align="center">基本操作</div>
                                    </th>
                                </tr>
                                </thead>

                                <tbody id="tableid">
                                {% for customer_care in customer_care_list %}
                                    <tr>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center" class="STYLE1">

                                                <div align="center">{{ forloop.counter }}</div>
                                            </div>
                                        </td>
                                        <input type="hidden" name="care_id" value="{{ customer_care.care_id }}">
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.customer.customer_name }}</span>
                                            </div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_theme }}</span></div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_way }}</span></div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_time|date:'Y-m-d H:i:s' }}</span>
                                            </div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_nexttime|date:'Y-m-d H:i:s' }}</span>
                                            </div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_remark }} </span></div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span
                                                    class="STYLE1">{{ customer_care.care_people }}</span></div>
                                        </td>


                                        <td height="20" bgcolor="#FFFFFF">
                                            <div align="center"><span class="STYLE4"><img src="/static/edt.gif"
                                                                                          width="16" height="16"/><a
                                                    href="../customer_care_edit/?num={{ customer_care.care_id }}">编辑</a>&nbsp; &nbsp;<img
                                                    src="/static/del.gif" width="16" height="16"/><a
                                                    href="../customer_care_del/?num={{ customer_care.care_id }}"
                                                    onclick="del()">删除</a></span></div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>


                            </table>
                        </td>
                        <td width="8" background="/static/tab_15.gif">&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td height="35" background="/static/tab_19.gif">
                <table id="downtable" width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="12" height="35"><img src="/static/tab_18.gif" width="12" height="35"/></td>
                        <td>
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td class="JX_STYLE4">&nbsp;&nbsp;共有 {{ customer_care_list.count }} 条记录
                                    </td>
                                    <td>
                                        <table border="0" align="right" cellpadding="0" cellspacing="0">

                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td width="16"><img src="/static/tab_20.gif" width="16" height="35"/></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</form>
<script type="text/javascript">


    function chick() {
        var content = $('#customerInput').val();
        var type = $('#queryType').val();
        $.get('../customer_care_list/', {'content': content, 'type': type}, function (result) {
            var r = result.flag;

            if (r) {
                var qlist = JSON.parse('[' + result.qlist + ']');

                var jlist = JSON.parse(result.jcustomer_care_list);
                for (var q = 0; q < qlist.length; q++) {
                    var eqe = qlist[q];
                }
                var htmlText = '';


                for (var i = 0; i < jlist.length; i++) {
                    var ele = jlist[i];
                    var care_time = ele.fields.care_time.replace('T', ' ').replace('Z', '');
                    var care_nexttime = ele.fields.care_nexttime.replace('T', ' ').replace('Z', '');
                    htmlText += '<tr id="trid" style="display: table-row">';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"><div align="center" class="STYLE1"><div align="center">' + ele.pk + '</div></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"><div align="center"><span class="STYLE1">' + eqe.customer_name + '</span></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"><div align="center"><span class="STYLE1">' + ele.fields.care_theme + '</span></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"><div align="center"><span class="STYLE1">' + ele.fields.care_way + '</span></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"> <div align="center"><span class="STYLE1">' + care_time + '</span></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"> <div align="center"><span class="STYLE1">' + care_nexttime + '</span></div> </td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"> <div align="center"><span class="STYLE1">' + ele.fields.care_remark + '</span></div></td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"> <div align="center"><span class="STYLE1">' + ele.fields.care_people + '</span></div> </td>';
                    htmlText += '<td height="20" bgcolor="#FFFFFF"> <div align="center"><span class="STYLE1">' + '<a href="javascript:edit(' + ele.pk + ')" >编辑</a>&nbsp;&nbsp;<a href="javascript:del(' + ele.pk + ')" >删除</a>' + '</span></div> </td>';
                }
                $('#tableid').empty();
                $('#tableid').append(htmlText);
                $('.JX_STYLE4').empty();
                $('.JX_STYLE4').append('<td class="STYLE4">' + '&nbsp;' + '&nbsp;' + '共有' + jlist.length + '条记录' + '</td>');


            }
            else {
                $('#tableid').empty();
{#                $('#tableid').append('*查询不存在*');#}
                $('.JX_STYLE4').empty();
                $('.JX_STYLE4').append('<td class="STYLE4">' + '&nbsp;' + '&nbsp;' + '共有' + 0 + '条记录' + '</td>');

            }


        })
    }

    function del(pk) {
        console.log('[del]-pk: ' + pk);
        window.location.href = "../customer_care_del/?num=" + pk;
        {#        window.location.reload();#}
    }

    function edit(pk) {
        console.log('[edit]-pk: ' + pk);
        window.location.href = "../customer_care_edit/?num=" + pk;
    }
</script>
</body>

</html>
<SCRIPT Language=VBScript><!--

//-->



</SCRIPT>